# About GRPC

- Server 监听是循环等待连接，若没有则休眠，最大休眠时间 1s；若接收到新请求则起一个新的 goroutine 去处理。

- grpc.ClientConn 不关闭连接，会导致 goroutine 和 Memory 等泄露。

#### 1、调 grpc.Dial 会真正去连接server吗？

会，但是是异步连接的，连接状态为正在连接。但如果设置了 `grpc.WithBlock` 选项，就会阻塞等待等待握手成功。另外需要注意，当未设置 `grpc.WithBlock` 时，ctx 超时控制对其无任何效果。



#### 2、客户端请求失败后会默认重试吗？

会不断地进行重试，直到上下文取消。而重试时间方面采用 backoff 算法作为的重连机制，默认的最大重试时间间隔是120s。



#### 3、在 Kubernetes 中 gRPC 负载均衡有问题？

gRPC 的 RPC 协议是基于 HTTP/2 标准实现的，HTTP/2 的一大特性就是不需要像 HTTP/1.1 一样，每次发出请求都要重新建立一个新连接，而是会复用原有的连接。

所以这将导致 kube-proxy 只有在连接建立时才会做负载均衡，而在这之后的每一次 RPC 请求都会利用原本的连接，那么实际上后续的每一次的 RPC 请求都跑到了同一个地方。

（注：使用 k8s service 做负载均衡的情况下）