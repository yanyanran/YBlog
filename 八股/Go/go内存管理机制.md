## go内存管理机制

golang内存分配器借鉴了TCMalloc的设计思想：一次性或提前分配**多级内存模块**，减少内存分配时锁的使用和与操作系统的沟通；**多尺度内存单元**，减少内存分配产生碎片。

1. *每次从操作系统申请一大块内存，以减少系统调用；*
2. *将申请的大块内存按照特定大小预先切成小块，构成链表；*
3. *为对象分配内存时，从大小合适的链表中提取一块即可；*
4. *如果对象销毁，则将对象占用的内存，归还到原链表，以便复用；*
5. *如果限制内存过多，则尝试归还部分给操作系统，降低整体开销。*

go的内存管理分为：**栈内存管理**和**堆内存管理**。栈上内存由编译器管理，堆上内存由程序管理，在运行期间申请和释放（垃圾回收）。

**栈与堆相比劣势：**

1、栈空间较小（8M或10M），不适合存放空间占用大的对象

2、函数内的局部变量离开函数体会被自动弹出栈，所以离开函数作用域依然存活的指针也不适合栈存放

**栈与堆相比优势：**

1、管理简单（由编译器完成）

2、分配和释放速度快（无垃圾回收过程）

3、栈上内存有很好的局部性（堆上2块数据可能分布在不同的页上）