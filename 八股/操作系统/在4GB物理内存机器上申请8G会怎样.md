## 在4GB物理内存机器上申请8G会怎样

#### 32位系统

内核空间占用1G，位于最高处，剩下3G是用户空间。进程最多只能申请3GB的虚拟内存空间，所以进程申请 8GB 内存**在申请虚拟内存阶段就会失败**



> 之前面试被问到一个问题：
>
> #### 如何在只有4GB虚拟地址（32位系统）下访问8GB虚拟地址的内容？
>
> 涉及到**high memory**的概念。linux内核没把整个1G内核空间全用于线性映射，只映射了最多896M物理内存，**预留了最高端的128M虚拟地址空间**给IO设备和其他用途。
>
> 当内核需要分配high memory时，通过kmap从预留的地址空间中动态分配一个地址然后映射到high memory，从而访问这个物理页。high memory映射到内核地址空间一般是暂时性的映射，不是永久映射。



#### 64位系统

内核空间和用户空间都是128T，占据整个内存空间的最高和最低处，剩下中间部分未定义。进程可以使用128 TB大小的虚拟内存，所以进程申请8GB内存没问题（因为申请的是虚拟内存）。**只要不读写这个虚拟内存，操作系统就不会分配物理内存。**



#### 那我就要访问-> 看系统有没有Swap分区

- 没有：因为物理空间不够，进程会被操作系统杀掉，原因是OOM（内存溢出）
- 有：即使物理内存只有 4GB，程序也能正常使用8GB的内存，进程可以正常运行