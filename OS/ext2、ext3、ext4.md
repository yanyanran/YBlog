## ext2、ext3、ext4

#### ext2和ext3区别

ext3在ext2基础上增加了**日志功能**。因为：

1、EXT2文件系统在异常关机后，再开机后会造成文件系统的数据不一致，这时必须做文件系统的修复工作，将不一致与错误的地方修复，耗时的且也不能百分之百保证所有数据都不会流失。

2、CPU速度越来越快，RAM内存越来越大，磁盘高速缓存容量迅速增加。因此对于大多数读操作请求来说，有可能直接从高速缓存中得到而不必去真正访问磁盘。

所以设计了**日志式文件系统 JFS**，最大的特点是它会将整个磁盘的写入动作完整记录在磁盘的某个区域上，以便有需要时可以回溯追踪。



#### ext3特点

**1、高可用性**

宕机发生后，恢复ext3文件系统只要数十秒钟。

**2、数据完整性**

ext3能极大地提高文件系统的完整性，避免了意外宕机对文件系统的破坏。

在保证数据完整性方面，ext3文件系统有2种模式可选，其中之一就是“同时保持文件系统及数据的一致性”模式。

**3、文件系统速度**

因为ext3的日志功能对磁盘的驱动器读写头进行了优化，尽管用ext3文件系统有时在存储数据时可能要多次写数据，但从总体看来，ext3比ext2的性能要好些。

**4、数据转换**

由ext2转成ext3非常容易，只要简单地键入两条命令即可完成整个转换过程，用户不用花时间备份、恢复、格式化分区等。

**5、多种日志模式**

ext3有多种日志模式，一种工作模式是对所有文件数据及metadata（定义文件系统中数据的数据）进行日志记录（data=journal模式）；

另种工作模式则是只对metadata记录日志而不对数据进行日志记录，也即所谓data=ordered或者data=writeback模式。

系统管理人员可根据系统实际工作要求，在系统的工作速度与文件数据的一致性之间作出选择。



#### ext4特点

**1、更大的文件系统和更大的文件**

ext3目前支持最大 16TB 文件系统和 2TB 文件，ext4 分别支持 1EB（1,048,576TB， 1EB=1024PB， 1PB=1024TB）文件系统以及 16TB 文件

**2、无限数量的子目录**

ext3只支持 32,000 个子目录，而 ext4 支持无限数量子目录

**3、Extents**

ext3 采用间接块映射，当操作大文件时效率极其低下。比如一个 100MB 大小文件在 Ext3 中要建立 25,600 个数据块（每个数据块大小为 4KB）的映射表。

而 Ext4 引入了现代文件系统中流行的 extents 概念，每个 extent 为一组连续的数据块，上述文件则表示为“该文件数据保存在接下来的 25,600 个数据块中”，提高了不少效率。

**4、多块分配**

当写入数据到 Ext3 文件系统中时，Ext3 的数据块分配器每次只能分配一个 4KB 的块，写一个 100MB 文件就要调用 25,600 次数据块分配器，而 Ext4 的多块分配器mballoc 支持一次调用分配多个数据块。

**5、延迟分配**

Ext3 的数据块分配策略是尽快分配，而 Ext4 和其它现代文件操作系统的策略是尽可能地延迟分配，直到文件在 cache 中写完才开始分配数据块并写入磁盘，这样就能优化整个文件的数据块分配，与前两种特性搭配起来可以显著提升性能。

**6、快速fsck**

以前执行 fsck 第一步就会很慢，因为它要检查所有的 inode，现在 Ext4 给每个组的 inode 表中都添加了一份未使用 inode 的列表，今后 fsck Ext4 文件系统就可以跳过它们而只去检查那些在用的 inode 了。

**7、日志校验**

日志是最常用的部分，也极易导致磁盘硬件故障，而从损坏的日志中恢复数据会导致更多的数据损坏。

Ext4 的日志校验功能可以很方便地判断日志数据是否损坏，而且它将 Ext3 的两阶段日志机制合并成一个阶段，在增加安全性的同时提高了性能。

**8、“无日志”模式**

日志总归有一些开销，Ext4 允许关闭日志，以便某些有特殊需求的用户可以借此提升性能。

**9、在线碎片整理**

尽管延迟分配、多块分配和 extents 能有效减少文件系统碎片，但碎片还是不可避免会产生。
Ext4 支持在线碎片整理，并提供 e4defrag 工具进行个别文件或整个文件系统的碎片整理。

**10、inode 相关特性**

Ext4 支持更大的 inode，较之 Ext3 默认的 inode 大小 128 字节，Ext4 为了在 inode 中容纳更多的扩展属性（如纳秒时间戳或 inode 版本），默认 inode 大小为 256 字节。