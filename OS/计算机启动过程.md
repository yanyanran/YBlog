# 计算机启动过程

### 1、只读内存ROM和程序BIOS

计算机通电后先读取ROM，里面的程序为**BIOS**，即基本输入输出系统。

> **cs : ip**
>
> cs寄存器-> 段基址     ip寄存器-> 段内偏移地址

开机瞬间，CPU的 `cs:ip` 寄存器被强制初始化为`0xF000 : 0xFFF0`。因为开机时处于**实模式**，在实模式下段基地址要*16，也就是左移4【等效地址为**0xFFFF0**】，这就是**BIOS的入口地址**。

实模式下的内存布局为顶大底小。从**0xF0000~0xFFFFF**，这顶部的640KB为**BIOS的地址范围**。其中上面说的BIOS的入口地址就是FFFF0~FFFFF这16字节，内容是一条跳转指令：`jmp f000: e05b`



BIOS首先检查计算机硬件



接着BIOS**校验启动盘中0盘0道1扇区的内容**。如果此512字节的扇区末尾2字节为0x55和0xaa，则BIOS认为此扇区中存在**主引导记录MBR**【告诉计算机到硬盘的哪一个位置去找操作系统】，就将MBR从磁盘加载到CPU物理内存`0x7c00`处，然后jmp到这继续执行，此后BIOS就完成了它的使命，将接力棒交给了MBR。

#### （1）MBR存在0盘0道1扇区的原因

选择站在距离BIOS最近的位置，BIOS就不用费力气一个个找了；

#### （2）加载MBR到0x7c00的原因

加载MBR的位置取决于*os本身所占内存*的大小。

**MBR**的任务是加载某个程序到指定位置（内核加载器），然后jmp后就没MBR的事了。**在它没执行完值之前，不能覆盖自己或者其他已有数据。**

MBR是个512字节的程序，除了512字节还需要分配所用栈的空间，**1KB**够用了。我们选择**把它放在内存末尾的最后1KB**，对谁都不影响。也就是（32KB-> 0x8000） - （1KB-> 0x400）= 0x7c00



### 2、MBR主场

接下来MBR开始执行。它会**把内核加载程序loader从硬盘加载到CPU物理内存`0x900`中去**。加载完毕后jmp到loader程序中，自此MBR使命完成，将接力棒传给loader。
